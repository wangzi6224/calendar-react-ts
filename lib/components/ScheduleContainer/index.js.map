{"version":3,"file":"index.js","names":["ScheduleContainer","scheduleRender","data","rangeStartAndEndKey","useContext","GlobalData","targetDay","height","useState","scrollHeight","setScrollHeight","HoursList","scheduleList","setScheduleList","moment","hour","minute","currTimeLineHeight","setCurrTimeLineHeight","containerWidth","setContainerWidth","isMoving","setIsMoving","movingTop","setMovingTop","useEffect","timeLineTimeID","setInterval","calcCurrTimeLineHeight","Date","getTime","clearInterval","result","todayTime","getZeroTime","i","push","timestampRange","dataItem","filter","item","length","useAutoScroll","containerList","document","getElementsByClassName","clientWidth","memo_ScheduleItem","useMemo","e","target","scrollTop","style","Calendar_ScheduleContainer_inner","map","index","Math","max","apply","x","isShowCurrTimeLine","params","Calendar_ScheduleContainer_outer","Calendar_ScheduleContainer_currTimeLine","top","Calendar_ScheduleContainer_startPoint"],"sources":["../../../src/components/ScheduleContainer/index.tsx"],"sourcesContent":["import moment from 'moment';\r\nimport style from './index.less';\r\nimport React, {useContext, useEffect, useMemo, useState} from 'react';\r\nimport { getDay, getMonth, getYear, getZeroTime } from '@/utils';\r\nimport ScheduleItem from '@/components/ScheduleItem';\r\nimport MovingBaseLine from '@/components/ScheduleContainer/components/MovingBaseLine';\r\nimport type { ScheduleContainerType, HourType, scheduleListType } from '@/data.d';\r\nimport {GlobalData} from \"@/components/Container\";\r\nimport {useAutoScroll} from \"@/hooks/useAutoScroll\";\r\nimport TimeScale from \"@/components/ScheduleContainer/components/TimeScale\";\r\n\r\nconst ScheduleContainer: React.FC<ScheduleContainerType> = ({\r\n  scheduleRender,\r\n  data,\r\n  rangeStartAndEndKey,\r\n}) => {\r\n  const {targetDay, height} = useContext(GlobalData);\r\n  // 同步滚动高度使用\r\n  const [scrollHeight, setScrollHeight] = useState<number>(0);\r\n  const [HoursList] = useState<HourType>([\r\n    0,\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    6,\r\n    7,\r\n    8,\r\n    9,\r\n    10,\r\n    11,\r\n    12,\r\n    13,\r\n    14,\r\n    15,\r\n    16,\r\n    17,\r\n    18,\r\n    19,\r\n    20,\r\n    21,\r\n    22,\r\n    23,\r\n    0,\r\n  ]);\r\n  const [scheduleList, setScheduleList] = useState<scheduleListType[]>([]);\r\n  const [currTimeLineHeight, setCurrTimeLineHeight] = useState<number>(\r\n    () => (moment(targetDay).hour() * 60 + moment(targetDay).minute()) / 2,\r\n  );\r\n  const [containerWidth, setContainerWidth] = useState<number>(0);\r\n  const [isMoving, setIsMoving] = useState<boolean>(false);\r\n  const [movingTop, setMovingTop] = useState<number>(0);\r\n\r\n  useEffect(() => {\r\n    // 当前时间线计时器\r\n    const timeLineTimeID = setInterval(() => {\r\n      setCurrTimeLineHeight(calcCurrTimeLineHeight(new Date().getTime()));\r\n    }, 1000);\r\n\r\n    return () => {\r\n      clearInterval(timeLineTimeID);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const result = [];\r\n    const todayTime: number = getZeroTime(targetDay) as number;\r\n    for (let i = 0; i < HoursList.length; i++) {\r\n      result.push({\r\n        timestampRange: [todayTime + i * 3600 * 1000, todayTime + (i + 1) * 3600 * 1000],\r\n        dataItem: data?.filter((item) => {\r\n          return (\r\n            item[rangeStartAndEndKey[0]] >= todayTime + i * 3600 * 1000 &&\r\n            item[rangeStartAndEndKey[0]] < todayTime + (i + 1) * 3600 * 1000\r\n          );\r\n        }),\r\n      });\r\n    }\r\n    setScheduleList(result);\r\n  }, [data, targetDay]);\r\n\r\n  useAutoScroll(targetDay, height)\r\n\r\n  useEffect(() => {\r\n    const containerList = document.getElementsByClassName(`Calendar_ScheduleItem_container`);\r\n    if (containerList[0]) {\r\n      setContainerWidth(containerList[0]?.clientWidth);\r\n    } else {\r\n      setContainerWidth(0);\r\n    }\r\n  }, [scheduleList, scheduleRender, targetDay]);\r\n\r\n  // 日程组件Item\r\n  const memo_ScheduleItem: JSX.Element = useMemo(\r\n    () => (\r\n      <div\r\n        id=\"Calendar_ScheduleContainer_inner\"\r\n        onScroll={(e) => setScrollHeight(-(e as any).target?.scrollTop)}\r\n        className={style.Calendar_ScheduleContainer_inner}\r\n      >\r\n        {scheduleList?.map((item, index) => (\r\n          <ScheduleItem\r\n            rangeStartAndEndKey={rangeStartAndEndKey}\r\n            setMovingTop={setMovingTop}\r\n            setIsMoving={setIsMoving}\r\n            id={`${item.timestampRange[0]}`}\r\n            width={containerWidth === 0 ? 0 : containerWidth + 4}\r\n            key={index}\r\n            dataItemLength={Math.max.apply(\r\n              null,\r\n              scheduleList?.map((x) => x?.dataItem?.length),\r\n            )}\r\n            dataItem={item.dataItem}\r\n            scheduleRender={scheduleRender}\r\n            timestampRange={item.timestampRange}\r\n          />\r\n        ))}\r\n      </div>\r\n    ),\r\n    [scheduleList, scheduleRender, containerWidth],\r\n  );\r\n\r\n  const isShowCurrTimeLine: (params: number) => boolean = (params) =>\r\n    getZeroTime(params) <= new Date().getTime() &&\r\n    new Date().getTime() < getZeroTime(params + 3600 * 24 * 1000);\r\n\r\n  const calcCurrTimeLineHeight: (params: number) => number = (params) =>\r\n    (moment(params).hour() * 60 + moment(params).minute()) / 2;\r\n\r\n  return (\r\n    <div\r\n      className={style.Calendar_ScheduleContainer_outer}\r\n      style={{ height: `${height - 155}px` }}\r\n    >\r\n      <>\r\n        <TimeScale HoursList={HoursList} scrollHeight={scrollHeight}/>\r\n        {memo_ScheduleItem}\r\n        <MovingBaseLine movingTop={movingTop} scrollHeight={scrollHeight} color=\"#1890ff\" visibility={isMoving} />\r\n        {isShowCurrTimeLine(targetDay) && (\r\n          <div\r\n            className={style.Calendar_ScheduleContainer_currTimeLine}\r\n            style={{ top: `${currTimeLineHeight + scrollHeight}px` }}\r\n          >\r\n            <div className={style.Calendar_ScheduleContainer_startPoint} />\r\n          </div>\r\n        )}\r\n      </>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ScheduleContainer;\r\n"],"mappings":"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"}