{"version":3,"file":"index.js","names":["isClick","initMouseTop","initOffsetTop","dataIndex","timeId","ScheduleItem","timestampRange","dataItem","scheduleRender","width","dataItemLength","id","onSlideChange","setIsMoving","setMovingTop","rangeStartAndEndKey","useContext","GlobalData","targetDay","isDraggable","calcHeight","timestampList","length","calcTop","startTime","moment","minute","calcWidth","w","d","ref","useRef","onMouseDown","e","targetEle","current","clientY","style","position","top","document","getElementById","offsetTop","body","addEventListener","onMouseMove","onMouseUp","currMouseOffset","err","console","log","currentTimeStamp","format","Math","floor","unix","timeDiff","removeEventListener","WT_Calendar_ScheduleItem_Fath","WT_Calendar_ScheduleItem","map","data","index","persist","setTimeout","clearTimeout","WT_Calendar_ScheduleItem_container","height"],"sources":["../../../src/components/ScheduleItem/index.tsx"],"sourcesContent":["import React, {Fragment, useContext, useRef} from 'react';\nimport style from './index.less';\nimport moment from 'moment';\nimport type { ScheduleItemType } from '@/data.d';\nimport {GlobalData} from \"@/components/Container\";\n\nlet isClick = false;\nlet initMouseTop = 0;\nlet initOffsetTop = 0;\nlet dataIndex: number = null;\nlet timeId = null;\n\nconst ScheduleItem: React.FC<ScheduleItemType> = ({\n  timestampRange,\n  dataItem,\n  scheduleRender,\n  width,\n  dataItemLength,\n  id,\n  onSlideChange,\n  setIsMoving,\n  setMovingTop,\n  rangeStartAndEndKey,\n}) => {\n  const {targetDay, isDraggable} = useContext(GlobalData);\n  // 计算容器高度\n  const calcHeight: (timestampList: [number, number]) => number = (timestampList) =>\n    timestampList.length > 1 ? (timestampList[1] - timestampList[0]) / 1000 / 60 / 2 : 30;\n  const calcTop: (startTime: number) => number = (startTime) => moment(startTime).minute() / 2;\n  // 计算 ScheduleItem 宽度\n  const calcWidth: (w: number, d: number) => string = (w, d) =>\n    width === 0 || dataItemLength * width < 347 ? '100%' : `${d * w}px`;\n  const ref = useRef<HTMLDivElement>();\n\n  const onMouseDown = (e) => {\n    const targetEle = ref.current;\n    initMouseTop = e.clientY;\n    targetEle.style.position = 'absolute';\n    targetEle.style.top = `${document.getElementById(id).offsetTop + targetEle.offsetTop}px`;\n    initOffsetTop = targetEle.offsetTop;\n    isClick = true;\n    setIsMoving(true);\n    document.body.addEventListener('mousemove', onMouseMove);\n    document.body.addEventListener('mouseup', onMouseUp);\n  };\n\n  const onMouseMove = (e) => {\n    try {\n      if (isClick) {\n        const targetEle = ref.current;\n        const currMouseOffset = e.clientY - initMouseTop;\n        targetEle.style.top = `${\n          initOffsetTop + currMouseOffset <= 0 ? 0 : initOffsetTop + currMouseOffset\n        }px`;\n        setMovingTop(initOffsetTop + currMouseOffset === 0 ? 0 : initOffsetTop + currMouseOffset);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const onMouseUp = () => {\n    try {\n      if (isClick) {\n        setIsMoving(false);\n        isClick = false;\n        const targetEle = ref.current;\n        const currentTimeStamp =\n          moment(\n            `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\n              targetEle.offsetTop / 30,\n            )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\n          ).unix() * 1000;\n        const timeDiff =\n          dataItem[dataIndex][rangeStartAndEndKey[1]] - dataItem[dataIndex][rangeStartAndEndKey[0]];\n        onSlideChange([currentTimeStamp, currentTimeStamp + timeDiff], dataItem[dataIndex]);\n      }\n      document.body.removeEventListener('mousemove', onMouseMove);\n      document.body.removeEventListener('mouseup', onMouseUp);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return (\n    <div id={id} className={style.WT_Calendar_ScheduleItem_Fath}>\n      <div\n        className={style.WT_Calendar_ScheduleItem}\n        style={{ width: calcWidth(width, dataItemLength) }}\n      >\n        {dataItem?.map((data, index) => {\n          return (\n            <Fragment key={`${data[rangeStartAndEndKey[0]]}${index}`}>\n              {data[rangeStartAndEndKey[0]] >= timestampRange[0] &&\n                data[rangeStartAndEndKey[0]] < timestampRange[1] && (\n                  <div\n                    ref={ref}\n                    key={`${data[rangeStartAndEndKey[0]]}${index}`}\n                    id={`${data[rangeStartAndEndKey[0]]}${index}`}\n                    onMouseDown={(e) => {\n                      if (!isDraggable) return;\n                      e.persist();\n                      timeId = setTimeout(() => {\n                        dataIndex = index;\n                        onMouseDown(e);\n                      }, 200);\n                    }}\n                    onMouseUp={() => {\n                      if (!isDraggable) return;\n                      clearTimeout(timeId);\n                    }}\n                    className={`${style.WT_Calendar_ScheduleItem_container} WT_Calendar_ScheduleItem_container`}\n                    style={{\n                      height: `${\n                        calcHeight([data[rangeStartAndEndKey[0]], data[rangeStartAndEndKey[1]]]) ||\n                        30\n                      }px`,\n                      top: calcTop(data[rangeStartAndEndKey[0]]),\n                    }}\n                  >\n                    {scheduleRender({ data, timestampRange })}\n                  </div>\n                )}\n            </Fragment>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default ScheduleItem;\n"],"mappings":"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"}