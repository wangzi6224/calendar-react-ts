{"version":3,"file":"index.js","names":["isClick","initMouseTop","initOffsetTop","dataIndex","timeId","containerInitHeight","ScheduleItem","timestampRange","dataItem","scheduleRender","width","dataItemLength","id","setIsMoving","setMovingTop","rangeStartAndEndKey","useContext","GlobalData","targetDay","isDraggable","changeScheduleDataHandle","calcHeight","timestampList","length","calcTop","startTime","moment","minute","calcWidth","w","d","ref","useRef","mouseDownHandle","e","index","persist","setTimeout","targetEle","current","clientY","style","position","top","document","getElementById","offsetTop","body","addEventListener","onMouseMove","mouseUpHandle","requestAnimationFrame","currMouseOffset","err","console","log","currentTimeStamp","format","Math","floor","unix","timeDiff","removeEventListener","timeRangeShow","params","changeRangeMouseMove","ev","height","getHeightAttrNumber","replace","rangeChangeHandle","data","stopPropagation","rangeChangeMouseUp","containerHeight","WT_Calendar_ScheduleItem_Fath","WT_Calendar_ScheduleItem","map","clearTimeout","WT_Calendar_ScheduleItem_container","WT_Calendar_ScheduleItem_bottomLine"],"sources":["../../../src/components/ScheduleItem/index.tsx"],"sourcesContent":["import React, {Fragment, useContext, useRef} from 'react';\r\nimport style from './index.less';\r\nimport moment from 'moment';\r\nimport type {dataType, ScheduleItemType} from '@/data.d';\r\nimport {GlobalData} from \"@/components/Container\";\r\n\r\nlet isClick = false;\r\nlet initMouseTop = 0;\r\nlet initOffsetTop = 0;\r\nlet dataIndex: number = null;\r\nlet timeId = null;\r\nlet containerInitHeight = 0;\r\n\r\nconst ScheduleItem: React.FC<ScheduleItemType> = ({\r\n  timestampRange,\r\n  dataItem,\r\n  scheduleRender,\r\n  width,\r\n  dataItemLength,\r\n  id,\r\n  setIsMoving,\r\n  setMovingTop,\r\n  rangeStartAndEndKey,\r\n}) => {\r\n  const {targetDay, isDraggable, changeScheduleDataHandle} = useContext(GlobalData);\r\n  // 计算容器高度\r\n  const calcHeight: (timestampList: [number, number]) => number = (timestampList) =>\r\n    timestampList.length > 1 ? (timestampList[1] - timestampList[0]) / 1000 / 60 / 2 : 30;\r\n  const calcTop: (startTime: number) => number = (startTime) => moment(startTime).minute() / 2;\r\n  // 计算 ScheduleItem 宽度\r\n  const calcWidth: (w: number, d: number) => string = (w, d) =>\r\n    width === 0 || dataItemLength * width < 347 ? '100%' : `${d * w}px`;\r\n  const ref = useRef<HTMLDivElement>();\r\n\r\n  // 按下鼠标\r\n  const mouseDownHandle = (e, index) => {\r\n    if (!isDraggable) return;\r\n    e.persist();\r\n    timeId = setTimeout(() => {\r\n      dataIndex = index;\r\n      const targetEle = ref.current;\r\n      initMouseTop = e.clientY;\r\n      targetEle.style.position = 'absolute';\r\n      targetEle.style.top = `${document.getElementById(id).offsetTop + targetEle.offsetTop}px`;\r\n      initOffsetTop = targetEle.offsetTop;\r\n      isClick = true;\r\n      setIsMoving(true);\r\n      document.body.addEventListener('mousemove', onMouseMove);\r\n      document.body.addEventListener('mouseup', mouseUpHandle);\r\n    }, 200);\r\n  };\r\n\r\n  // 移动鼠标\r\n  const onMouseMove = (e) => {\r\n    try {\r\n      requestAnimationFrame(() => {\r\n        if (isClick) {\r\n          const targetEle = ref.current;\r\n          const currMouseOffset = e.clientY - initMouseTop;\r\n          targetEle.style.top = `${\r\n            initOffsetTop + currMouseOffset <= 0 ? 0 : initOffsetTop + currMouseOffset\r\n          }px`;\r\n          setMovingTop(initOffsetTop + currMouseOffset === 0 ? 0 : initOffsetTop + currMouseOffset);\r\n        }\r\n      })\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  // 抬起鼠标\r\n  const mouseUpHandle = () => {\r\n    try {\r\n      if (isClick) {\r\n        setIsMoving(false);\r\n        isClick = false;\r\n        const targetEle = ref.current;\r\n        const currentTimeStamp =\r\n          moment(\r\n            `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\r\n              targetEle.offsetTop / 30,\r\n            )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\r\n          ).unix() * 1000;\r\n        const timeDiff =\r\n          dataItem[dataIndex][rangeStartAndEndKey[1]] - dataItem[dataIndex][rangeStartAndEndKey[0]];\r\n        changeScheduleDataHandle([currentTimeStamp, currentTimeStamp + timeDiff], dataItem[dataIndex]);\r\n      }\r\n      document.body.removeEventListener('mousemove', onMouseMove);\r\n      document.body.removeEventListener('mouseup', mouseUpHandle);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const timeRangeShow = (params: dataType):boolean => (\r\n    params[rangeStartAndEndKey[0]] >= timestampRange[0] &&\r\n    params[rangeStartAndEndKey[0]] < timestampRange[1]\r\n  );\r\n\r\n  const changeRangeMouseMove = (ev) => {\r\n    requestAnimationFrame(() => {\r\n      const currMouseOffset = ev.clientY - initMouseTop;\r\n      ref.current.style.height = `${containerInitHeight + currMouseOffset}px`\r\n    })\r\n  };\r\n\r\n  const getHeightAttrNumber = (height: string): number => {\r\n    return +height.replace(/[^\\d.-]/g, '')\r\n  };\r\n\r\n  const rangeChangeHandle = (ev, data, index) => {\r\n    ev.stopPropagation();\r\n    dataIndex = index;\r\n    initMouseTop = ev.clientY;\r\n    containerInitHeight = getHeightAttrNumber(ref.current.style.height);\r\n    document.body.addEventListener('mousemove', changeRangeMouseMove);\r\n    document.body.addEventListener('mouseup', rangeChangeMouseUp);\r\n  }\r\n\r\n  const rangeChangeMouseUp = () => {\r\n    const targetEle = ref.current;\r\n    const currentTimeStamp =\r\n      moment(\r\n        `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\r\n          targetEle.offsetTop / 30,\r\n        )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\r\n      ).unix() * 1000;\r\n    const containerHeight = getHeightAttrNumber(ref.current.style.height);\r\n    changeScheduleDataHandle([currentTimeStamp, currentTimeStamp + containerHeight * 2 * 60 * 1000], dataItem[dataIndex]);\r\n    document.body.removeEventListener('mousemove', changeRangeMouseMove);\r\n    document.body.removeEventListener('mouseup', rangeChangeMouseUp);\r\n  }\r\n\r\n  return (\r\n    <div id={id} className={style.WT_Calendar_ScheduleItem_Fath}>\r\n      <div\r\n        className={style.WT_Calendar_ScheduleItem}\r\n        style={{ width: calcWidth(width, dataItemLength) }}\r\n      >\r\n        {dataItem?.map((data, index) => {\r\n          return (\r\n            <Fragment key={`${data[rangeStartAndEndKey[0]]}${index}`}>\r\n              {timeRangeShow(data) && (\r\n                  <div\r\n                    ref={ref}\r\n                    key={`${data[rangeStartAndEndKey[0]]}${index}`}\r\n                    id={`${data[rangeStartAndEndKey[0]]}${index}`}\r\n                    onMouseDown={(ev) => mouseDownHandle(ev, index)}\r\n                    onMouseUp={() => {\r\n                      if(isDraggable) {\r\n                        clearTimeout(timeId);\r\n                      }\r\n                    }}\r\n                    className={`${style.WT_Calendar_ScheduleItem_container}`}\r\n                    style={{\r\n                      height: `${\r\n                        calcHeight([data[rangeStartAndEndKey[0]], data[rangeStartAndEndKey[1]]]) ||\r\n                        30\r\n                      }px`,\r\n                      top: calcTop(data[rangeStartAndEndKey[0]]),\r\n                    }}\r\n                  >\r\n                    {scheduleRender({ data, timestampRange })}\r\n                    <div\r\n                      onMouseDown={(ev) => {\r\n                        rangeChangeHandle(ev, data, index)\r\n                      }}\r\n                      onMouseUp={rangeChangeMouseUp}\r\n                      className={style.WT_Calendar_ScheduleItem_bottomLine}\r\n                    />\r\n                  </div>\r\n                )}\r\n            </Fragment>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ScheduleItem;\r\n"],"mappings":"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"}