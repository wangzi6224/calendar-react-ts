{"version":3,"file":"index.js","names":["React","Fragment","useContext","useRef","style","moment","GlobalData","isClick","initMouseTop","initOffsetTop","dataIndex","timeId","ScheduleItem","timestampRange","dataItem","scheduleRender","width","dataItemLength","id","onSlideChange","setIsMoving","setMovingTop","rangeStartAndEndKey","targetDay","isDraggable","calcHeight","timestampList","length","calcTop","startTime","minute","calcWidth","w","d","ref","onMouseDown","e","targetEle","current","clientY","position","top","document","getElementById","offsetTop","body","addEventListener","onMouseMove","onMouseUp","currMouseOffset","err","console","log","currentTimeStamp","format","Math","floor","unix","timeDiff","removeEventListener","WT_Calendar_ScheduleItem_Fath","WT_Calendar_ScheduleItem","map","data","index","persist","setTimeout","clearTimeout","WT_Calendar_ScheduleItem_container","height"],"sources":["../../../src/components/ScheduleItem/index.tsx"],"sourcesContent":["import React, {Fragment, useContext, useRef} from 'react';\nimport style from './index.less';\nimport moment from 'moment';\nimport type { ScheduleItemType } from '@/data.d';\nimport {GlobalData} from \"@/components/Container\";\n\nlet isClick = false;\nlet initMouseTop = 0;\nlet initOffsetTop = 0;\nlet dataIndex: number = null;\nlet timeId = null;\n\nconst ScheduleItem: React.FC<ScheduleItemType> = ({\n  timestampRange,\n  dataItem,\n  scheduleRender,\n  width,\n  dataItemLength,\n  id,\n  onSlideChange,\n  setIsMoving,\n  setMovingTop,\n  rangeStartAndEndKey,\n}) => {\n  const {targetDay, isDraggable} = useContext(GlobalData);\n  // 计算容器高度\n  const calcHeight: (timestampList: [number, number]) => number = (timestampList) =>\n    timestampList.length > 1 ? (timestampList[1] - timestampList[0]) / 1000 / 60 / 2 : 30;\n  const calcTop: (startTime: number) => number = (startTime) => moment(startTime).minute() / 2;\n  // 计算 ScheduleItem 宽度\n  const calcWidth: (w: number, d: number) => string = (w, d) =>\n    width === 0 || dataItemLength * width < 347 ? '100%' : `${d * w}px`;\n  const ref = useRef<HTMLDivElement>();\n\n  const onMouseDown = (e) => {\n    const targetEle = ref.current;\n    initMouseTop = e.clientY;\n    targetEle.style.position = 'absolute';\n    targetEle.style.top = `${document.getElementById(id).offsetTop + targetEle.offsetTop}px`;\n    initOffsetTop = targetEle.offsetTop;\n    isClick = true;\n    setIsMoving(true);\n    document.body.addEventListener('mousemove', onMouseMove);\n    document.body.addEventListener('mouseup', onMouseUp);\n  };\n\n  const onMouseMove = (e) => {\n    try {\n      if (isClick) {\n        const targetEle = ref.current;\n        const currMouseOffset = e.clientY - initMouseTop;\n        targetEle.style.top = `${\n          initOffsetTop + currMouseOffset <= 0 ? 0 : initOffsetTop + currMouseOffset\n        }px`;\n        setMovingTop(initOffsetTop + currMouseOffset === 0 ? 0 : initOffsetTop + currMouseOffset);\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const onMouseUp = () => {\n    try {\n      if (isClick) {\n        setIsMoving(false);\n        isClick = false;\n        const targetEle = ref.current;\n        const currentTimeStamp =\n          moment(\n            `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\n              targetEle.offsetTop / 30,\n            )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\n          ).unix() * 1000;\n        const timeDiff =\n          dataItem[dataIndex][rangeStartAndEndKey[1]] - dataItem[dataIndex][rangeStartAndEndKey[0]];\n        onSlideChange([currentTimeStamp, currentTimeStamp + timeDiff], dataItem[dataIndex]);\n      }\n      document.body.removeEventListener('mousemove', onMouseMove);\n      document.body.removeEventListener('mouseup', onMouseUp);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return (\n    <div id={id} className={style.WT_Calendar_ScheduleItem_Fath}>\n      <div\n        className={style.WT_Calendar_ScheduleItem}\n        style={{ width: calcWidth(width, dataItemLength) }}\n      >\n        {dataItem?.map((data, index) => {\n          return (\n            <Fragment key={`${data[rangeStartAndEndKey[0]]}${index}`}>\n              {data[rangeStartAndEndKey[0]] >= timestampRange[0] &&\n                data[rangeStartAndEndKey[0]] < timestampRange[1] && (\n                  <div\n                    ref={ref}\n                    key={`${data[rangeStartAndEndKey[0]]}${index}`}\n                    id={`${data[rangeStartAndEndKey[0]]}${index}`}\n                    onMouseDown={(e) => {\n                      if (!isDraggable) return;\n                      e.persist();\n                      timeId = setTimeout(() => {\n                        dataIndex = index;\n                        onMouseDown(e);\n                      }, 200);\n                    }}\n                    onMouseUp={() => {\n                      if (!isDraggable) return;\n                      clearTimeout(timeId);\n                    }}\n                    className={`${style.WT_Calendar_ScheduleItem_container} WT_Calendar_ScheduleItem_container`}\n                    style={{\n                      height: `${\n                        calcHeight([data[rangeStartAndEndKey[0]], data[rangeStartAndEndKey[1]]]) ||\n                        30\n                      }px`,\n                      top: calcTop(data[rangeStartAndEndKey[0]]),\n                    }}\n                  >\n                    {scheduleRender({ data, timestampRange })}\n                  </div>\n                )}\n            </Fragment>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default ScheduleItem;\n"],"mappings":"AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,UAAzB,EAAqCC,MAArC,QAAkD,OAAlD;AACA,OAAOC,KAAP,MAAkB,cAAlB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,SAAQC,UAAR,QAAyB,wBAAzB;AAEA,IAAIC,OAAO,GAAG,KAAd;AACA,IAAIC,YAAY,GAAG,CAAnB;AACA,IAAIC,aAAa,GAAG,CAApB;AACA,IAAIC,SAAiB,GAAG,IAAxB;AACA,IAAIC,MAAM,GAAG,IAAb;;AAEA,IAAMC,YAAwC,GAAG,SAA3CA,YAA2C,OAW3C;EAAA,IAVJC,cAUI,QAVJA,cAUI;EAAA,IATJC,QASI,QATJA,QASI;EAAA,IARJC,cAQI,QARJA,cAQI;EAAA,IAPJC,KAOI,QAPJA,KAOI;EAAA,IANJC,cAMI,QANJA,cAMI;EAAA,IALJC,EAKI,QALJA,EAKI;EAAA,IAJJC,aAII,QAJJA,aAII;EAAA,IAHJC,WAGI,QAHJA,WAGI;EAAA,IAFJC,YAEI,QAFJA,YAEI;EAAA,IADJC,mBACI,QADJA,mBACI;;EACJ,kBAAiCpB,UAAU,CAACI,UAAD,CAA3C;EAAA,IAAOiB,SAAP,eAAOA,SAAP;EAAA,IAAkBC,WAAlB,eAAkBA,WAAlB,CADI,CAEJ;;;EACA,IAAMC,UAAuD,GAAG,SAA1DA,UAA0D,CAACC,aAAD;IAAA,OAC9DA,aAAa,CAACC,MAAd,GAAuB,CAAvB,GAA2B,CAACD,aAAa,CAAC,CAAD,CAAb,GAAmBA,aAAa,CAAC,CAAD,CAAjC,IAAwC,IAAxC,GAA+C,EAA/C,GAAoD,CAA/E,GAAmF,EADrB;EAAA,CAAhE;;EAEA,IAAME,OAAsC,GAAG,SAAzCA,OAAyC,CAACC,SAAD;IAAA,OAAexB,MAAM,CAACwB,SAAD,CAAN,CAAkBC,MAAlB,KAA6B,CAA5C;EAAA,CAA/C,CALI,CAMJ;;;EACA,IAAMC,SAA2C,GAAG,SAA9CA,SAA8C,CAACC,CAAD,EAAIC,CAAJ;IAAA,OAClDjB,KAAK,KAAK,CAAV,IAAeC,cAAc,GAAGD,KAAjB,GAAyB,GAAxC,GAA8C,MAA9C,GAA0DiB,CAAC,GAAGD,CAA9D,OADkD;EAAA,CAApD;;EAEA,IAAME,GAAG,GAAG/B,MAAM,EAAlB;;EAEA,IAAMgC,YAAW,GAAG,SAAdA,WAAc,CAACC,CAAD,EAAO;IACzB,IAAMC,SAAS,GAAGH,GAAG,CAACI,OAAtB;IACA9B,YAAY,GAAG4B,CAAC,CAACG,OAAjB;IACAF,SAAS,CAACjC,KAAV,CAAgBoC,QAAhB,GAA2B,UAA3B;IACAH,SAAS,CAACjC,KAAV,CAAgBqC,GAAhB,GAAyBC,QAAQ,CAACC,cAAT,CAAwBzB,EAAxB,EAA4B0B,SAA5B,GAAwCP,SAAS,CAACO,SAA3E;IACAnC,aAAa,GAAG4B,SAAS,CAACO,SAA1B;IACArC,OAAO,GAAG,IAAV;IACAa,WAAW,CAAC,IAAD,CAAX;IACAsB,QAAQ,CAACG,IAAT,CAAcC,gBAAd,CAA+B,WAA/B,EAA4CC,WAA5C;IACAL,QAAQ,CAACG,IAAT,CAAcC,gBAAd,CAA+B,SAA/B,EAA0CE,SAA1C;EACD,CAVD;;EAYA,IAAMD,WAAW,GAAG,SAAdA,WAAc,CAACX,CAAD,EAAO;IACzB,IAAI;MACF,IAAI7B,OAAJ,EAAa;QACX,IAAM8B,SAAS,GAAGH,GAAG,CAACI,OAAtB;QACA,IAAMW,eAAe,GAAGb,CAAC,CAACG,OAAF,GAAY/B,YAApC;QACA6B,SAAS,CAACjC,KAAV,CAAgBqC,GAAhB,IACEhC,aAAa,GAAGwC,eAAhB,IAAmC,CAAnC,GAAuC,CAAvC,GAA2CxC,aAAa,GAAGwC,eAD7D;QAGA5B,YAAY,CAACZ,aAAa,GAAGwC,eAAhB,KAAoC,CAApC,GAAwC,CAAxC,GAA4CxC,aAAa,GAAGwC,eAA7D,CAAZ;MACD;IACF,CATD,CASE,OAAOC,GAAP,EAAY;MACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ;IACD;EACF,CAbD;;EAeA,IAAMF,SAAS,GAAG,SAAZA,SAAY,GAAM;IACtB,IAAI;MACF,IAAIzC,OAAJ,EAAa;QACXa,WAAW,CAAC,KAAD,CAAX;QACAb,OAAO,GAAG,KAAV;QACA,IAAM8B,SAAS,GAAGH,GAAG,CAACI,OAAtB;QACA,IAAMe,gBAAgB,GACpBhD,MAAM,CACDA,MAAM,CAACkB,SAAD,CAAN,CAAkB+B,MAAlB,CAAyB,YAAzB,CADC,SACyCC,IAAI,CAACC,KAAL,CAC3CnB,SAAS,CAACO,SAAV,GAAsB,EADqB,CADzC,SAGCW,IAAI,CAACC,KAAL,CAAanB,SAAS,CAACO,SAAV,GAAsB,EAAvB,GAA6B,EAA9B,GAAoC,EAA/C,CAHD,SAAN,CAIEa,IAJF,KAIW,IALb;QAMA,IAAMC,QAAQ,GACZ5C,QAAQ,CAACJ,SAAD,CAAR,CAAoBY,mBAAmB,CAAC,CAAD,CAAvC,IAA8CR,QAAQ,CAACJ,SAAD,CAAR,CAAoBY,mBAAmB,CAAC,CAAD,CAAvC,CADhD;QAEAH,aAAa,CAAC,CAACkC,gBAAD,EAAmBA,gBAAgB,GAAGK,QAAtC,CAAD,EAAkD5C,QAAQ,CAACJ,SAAD,CAA1D,CAAb;MACD;;MACDgC,QAAQ,CAACG,IAAT,CAAcc,mBAAd,CAAkC,WAAlC,EAA+CZ,WAA/C;MACAL,QAAQ,CAACG,IAAT,CAAcc,mBAAd,CAAkC,SAAlC,EAA6CX,SAA7C;IACD,CAjBD,CAiBE,OAAOE,GAAP,EAAY;MACZC,OAAO,CAACC,GAAR,CAAYF,GAAZ;IACD;EACF,CArBD;;EAuBA,oBACE;IAAK,EAAE,EAAEhC,EAAT;IAAa,SAAS,EAAEd,KAAK,CAACwD;EAA9B,gBACE;IACE,SAAS,EAAExD,KAAK,CAACyD,wBADnB;IAEE,KAAK,EAAE;MAAE7C,KAAK,EAAEe,SAAS,CAACf,KAAD,EAAQC,cAAR;IAAlB;EAFT,GAIGH,QAJH,oBAIGA,QAAQ,CAAEgD,GAAV,CAAc,UAACC,IAAD,EAAOC,KAAP,EAAiB;IAC9B,oBACE,oBAAC,QAAD;MAAU,GAAG,OAAKD,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAT,GAAoC0C;IAAjD,GACGD,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAJ,IAAgCT,cAAc,CAAC,CAAD,CAA9C,IACCkD,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAJ,GAA+BT,cAAc,CAAC,CAAD,CAD9C,iBAEG;MACE,GAAG,EAAEqB,GADP;MAEE,GAAG,OAAK6B,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAT,GAAoC0C,KAFzC;MAGE,EAAE,OAAKD,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAT,GAAoC0C,KAHxC;MAIE,WAAW,EAAE,qBAAC5B,CAAD,EAAO;QAClB,IAAI,CAACZ,WAAL,EAAkB;QAClBY,CAAC,CAAC6B,OAAF;QACAtD,MAAM,GAAGuD,UAAU,CAAC,YAAM;UACxBxD,SAAS,GAAGsD,KAAZ;;UACA7B,YAAW,CAACC,CAAD,CAAX;QACD,CAHkB,EAGhB,GAHgB,CAAnB;MAID,CAXH;MAYE,SAAS,EAAE,qBAAM;QACf,IAAI,CAACZ,WAAL,EAAkB;QAClB2C,YAAY,CAACxD,MAAD,CAAZ;MACD,CAfH;MAgBE,SAAS,EAAKP,KAAK,CAACgE,kCAAX,wCAhBX;MAiBE,KAAK,EAAE;QACLC,MAAM,GACJ5C,UAAU,CAAC,CAACsC,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAL,EAA+ByC,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAnC,CAAD,CAAV,IACA,EAFI,QADD;QAKLmB,GAAG,EAAEb,OAAO,CAACmC,IAAI,CAACzC,mBAAmB,CAAC,CAAD,CAApB,CAAL;MALP;IAjBT,GAyBGP,cAAc,CAAC;MAAEgD,IAAI,EAAJA,IAAF;MAAQlD,cAAc,EAAdA;IAAR,CAAD,CAzBjB,CAHN,CADF;EAkCD,CAnCA,CAJH,CADF,CADF;AA6CD,CArHD;;AAuHA,eAAeD,YAAf"}