{"version":3,"file":"index.js","names":["ScheduleCantainer","scheduleRender","data","onSlideChange","rangeStartAndEndKey","useContext","GlobalData","targetDay","height","useState","scrollHeight","setScrollHeight","HoursList","scheduleList","setScheduleList","moment","hour","minute","currTimeLineHeight","setCurrTimeLineHeight","containerWidth","setContainerWidth","isMoving","setIsMoving","movingTop","setMovingTop","autoPositionTime","useEffect","timeLineTimeID","setInterval","calcCurrTimeLineHeight","Date","getTime","clearInterval","resule","todayTime","getZeroTime","i","push","timestampRange","dataItem","filter","item","length","scrollTimeID","autoPositonScrollHandle","clearTimeout","containerList","document","getElementsByClassName","clientWidth","setTimeout","scrollContainerEle","getElementById","PositionTime","getYear","getMonth","getDay","unix","scrollTop","offsetTop","err","console","log","memo_ScheduleItem","useMemo","e","target","style","WT_Calendar_ScheduleCantainer_inner","map","index","Math","max","apply","x","memo_TimeScale","WT_Calendar_scale","top","position","h","WT_Calendar_scale_item","WT_Calendar_scale_text","movingBaseLine","isShowCurrTimeLine","params","WT_Calendar_ScheduleCantainer_outer","WT_Calendar_ScheduleCantainer_currTimeLine","WT_Calendar_ScheduleCantainer_startPoint"],"sources":["../../../src/components/ScheduleCantainer/index.tsx"],"sourcesContent":["import moment from 'moment';\nimport style from './index.less';\nimport React, {useContext, useEffect, useMemo, useState} from 'react';\nimport { getDay, getMonth, getYear, getZeroTime } from '@/utils';\nimport ScheduleItem from '@/components/ScheduleItem';\nimport MovingBaseLine from '@/components/ScheduleCantainer/MovingBaseLine';\nimport type { ScheduleCantainerType, HourType, scheduleListType } from '@/data.d';\nimport {GlobalData} from \"@/components/Container\";\n\nconst ScheduleCantainer: React.FC<ScheduleCantainerType> = ({\n  scheduleRender,\n  data,\n  onSlideChange,\n  rangeStartAndEndKey,\n}) => {\n  const {targetDay, height} = useContext(GlobalData);\n  // 同步滚动高度使用\n  const [scrollHeight, setScrollHeight] = useState<number>(0);\n  const [HoursList] = useState<HourType>([\n    0,\n    1,\n    2,\n    3,\n    4,\n    5,\n    6,\n    7,\n    8,\n    9,\n    10,\n    11,\n    12,\n    13,\n    14,\n    15,\n    16,\n    17,\n    18,\n    19,\n    20,\n    21,\n    22,\n    23,\n    0,\n  ]);\n  const [scheduleList, setScheduleList] = useState<scheduleListType[]>([]);\n  const [currTimeLineHeight, setCurrTimeLineHeight] = useState<number>(\n    () => (moment(targetDay).hour() * 60 + moment(targetDay).minute()) / 2,\n  );\n  const [containerWidth, setContainerWidth] = useState<number>(0);\n  const [isMoving, setIsMoving] = useState<boolean>(false);\n  const [movingTop, setMovingTop] = useState<number>(0);\n  const [autoPositionTime] = useState(targetDay);\n\n  useEffect(() => {\n    // 当前时间线计时器\n    const timeLineTimeID = setInterval(() => {\n      setCurrTimeLineHeight(calcCurrTimeLineHeight(new Date().getTime()));\n    }, 1000);\n\n    return () => {\n      clearInterval(timeLineTimeID);\n    };\n  }, []);\n\n  useEffect(() => {\n    const resule = [];\n    const todayTime: number = getZeroTime(targetDay) as number;\n    for (let i = 0; i < HoursList.length; i++) {\n      resule.push({\n        timestampRange: [todayTime + i * 3600 * 1000, todayTime + (i + 1) * 3600 * 1000],\n        dataItem: data?.filter((item) => {\n          return (\n            item[rangeStartAndEndKey[0]] >= todayTime + i * 3600 * 1000 &&\n            item[rangeStartAndEndKey[0]] < todayTime + (i + 1) * 3600 * 1000\n          );\n        }),\n      });\n    }\n    const scrollTimeID: NodeJS.Timeout = autoPositonScrollHandle();\n    setScheduleList(resule);\n    return () => {\n      clearTimeout(scrollTimeID);\n    };\n  }, [data, targetDay]);\n\n  useEffect(() => {\n    const containerList = document.getElementsByClassName(`WT_Calendar_ScheduleItem_container`);\n    if (containerList[0]) {\n      setContainerWidth(containerList[0]?.clientWidth);\n    } else {\n      setContainerWidth(0);\n    }\n  }, [scheduleList, scheduleRender, targetDay]);\n\n  // 自动滚动到定位的日程\n  const autoPositonScrollHandle: () => NodeJS.Timeout = () => {\n    return setTimeout(() => {\n      try {\n        const scrollContainerEle = document.getElementById('WT_Calendar_ScheduleCantainer_inner');\n        const PositionTime: number =\n          moment(\n            `${getYear(autoPositionTime)}/${getMonth(autoPositionTime)}/${getDay(\n              autoPositionTime,\n            )} ${moment(autoPositionTime).hour()}:00:00`,\n          ).unix() * 1000;\n        scrollContainerEle.scrollTop =\n          document.getElementById(`${PositionTime}`)?.offsetTop - height / 3;\n      } catch (err) {\n        console.log('自动滚动报错---->', err);\n      }\n    }, 20);\n  };\n\n  // 日程组件Item\n  const memo_ScheduleItem: JSX.Element = useMemo(\n    () => (\n      <div\n        id=\"WT_Calendar_ScheduleCantainer_inner\"\n        onScroll={(e) => setScrollHeight(-(e as any).target?.scrollTop)}\n        className={style.WT_Calendar_ScheduleCantainer_inner}\n      >\n        {scheduleList?.map((item, index) => (\n          <ScheduleItem\n            rangeStartAndEndKey={rangeStartAndEndKey}\n            setMovingTop={setMovingTop}\n            setIsMoving={setIsMoving}\n            onSlideChange={onSlideChange}\n            id={`${item.timestampRange[0]}`}\n            width={containerWidth === 0 ? 0 : containerWidth + 4}\n            key={index}\n            dataItemLength={Math.max.apply(\n              null,\n              scheduleList?.map((x) => x?.dataItem?.length),\n            )}\n            dataItem={item.dataItem}\n            scheduleRender={scheduleRender}\n            timestampRange={item.timestampRange}\n          />\n        ))}\n      </div>\n    ),\n    [scheduleList, scheduleRender, containerWidth],\n  );\n\n  // 左侧时间刻度\n  const memo_TimeScale: JSX.Element = useMemo(\n    () => (\n      <div\n        className={style.WT_Calendar_scale}\n        style={{ height: `${HoursList.length * 30}px`, top: scrollHeight }}\n      >\n        <div style={{ position: 'relative' }}>\n          {HoursList.map((h, index) => (\n            <div className={style.WT_Calendar_scale_item} key={index}>\n              <span className={style.WT_Calendar_scale_text} style={{ top: index === 0 && -5 }}>\n                {`${h < 10 ? `0${h}` : h}:00`}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n    ),\n    [scrollHeight],\n  );\n\n  // 拖动时间基线\n  const movingBaseLine: JSX.Element = useMemo(\n    () => <MovingBaseLine movingTop={movingTop} scrollHeight={scrollHeight} isShow={isMoving} />,\n    [movingTop, scrollHeight, isMoving],\n  );\n\n  const isShowCurrTimeLine: (params: number) => boolean = (params) =>\n    getZeroTime(params) <= new Date().getTime() &&\n    new Date().getTime() < getZeroTime(params + 3600 * 24 * 1000);\n\n  const calcCurrTimeLineHeight: (params: number) => number = (params) =>\n    (moment(params).hour() * 60 + moment(params).minute()) / 2;\n\n  return (\n    <div\n      className={style.WT_Calendar_ScheduleCantainer_outer}\n      style={{ height: `${height - 155}px` }}\n    >\n      <>\n        {memo_TimeScale}\n        {memo_ScheduleItem}\n        {movingBaseLine}\n        {isShowCurrTimeLine(targetDay) && (\n          <div\n            className={style.WT_Calendar_ScheduleCantainer_currTimeLine}\n            style={{ top: `${currTimeLineHeight + scrollHeight}px` }}\n          >\n            <div className={style.WT_Calendar_ScheduleCantainer_startPoint} />\n          </div>\n        )}\n      </>\n    </div>\n  );\n};\n\nexport default ScheduleCantainer;\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;;;AAEA,IAAMA,iBAAkD,GAAG,SAArDA,iBAAqD,OAKrD;EAAA,IAJJC,cAII,QAJJA,cAII;EAAA,IAHJC,IAGI,QAHJA,IAGI;EAAA,IAFJC,aAEI,QAFJA,aAEI;EAAA,IADJC,mBACI,QADJA,mBACI;;EACJ,kBAA4B,IAAAC,iBAAA,EAAWC,qBAAX,CAA5B;EAAA,IAAOC,SAAP,eAAOA,SAAP;EAAA,IAAkBC,MAAlB,eAAkBA,MAAlB,CADI,CAEJ;;;EACA,gBAAwC,IAAAC,eAAA,EAAiB,CAAjB,CAAxC;EAAA,IAAOC,YAAP;EAAA,IAAqBC,eAArB;;EACA,iBAAoB,IAAAF,eAAA,EAAmB,CACrC,CADqC,EAErC,CAFqC,EAGrC,CAHqC,EAIrC,CAJqC,EAKrC,CALqC,EAMrC,CANqC,EAOrC,CAPqC,EAQrC,CARqC,EASrC,CATqC,EAUrC,CAVqC,EAWrC,EAXqC,EAYrC,EAZqC,EAarC,EAbqC,EAcrC,EAdqC,EAerC,EAfqC,EAgBrC,EAhBqC,EAiBrC,EAjBqC,EAkBrC,EAlBqC,EAmBrC,EAnBqC,EAoBrC,EApBqC,EAqBrC,EArBqC,EAsBrC,EAtBqC,EAuBrC,EAvBqC,EAwBrC,EAxBqC,EAyBrC,CAzBqC,CAAnB,CAApB;EAAA,IAAOG,SAAP;;EA2BA,iBAAwC,IAAAH,eAAA,EAA6B,EAA7B,CAAxC;EAAA,IAAOI,YAAP;EAAA,IAAqBC,eAArB;;EACA,iBAAoD,IAAAL,eAAA,EAClD;IAAA,OAAM,CAAC,IAAAM,kBAAA,EAAOR,SAAP,EAAkBS,IAAlB,KAA2B,EAA3B,GAAgC,IAAAD,kBAAA,EAAOR,SAAP,EAAkBU,MAAlB,EAAjC,IAA+D,CAArE;EAAA,CADkD,CAApD;EAAA,IAAOC,kBAAP;EAAA,IAA2BC,qBAA3B;;EAGA,iBAA4C,IAAAV,eAAA,EAAiB,CAAjB,CAA5C;EAAA,IAAOW,cAAP;EAAA,IAAuBC,iBAAvB;;EACA,iBAAgC,IAAAZ,eAAA,EAAkB,KAAlB,CAAhC;EAAA,IAAOa,QAAP;EAAA,IAAiBC,WAAjB;;EACA,iBAAkC,IAAAd,eAAA,EAAiB,CAAjB,CAAlC;EAAA,IAAOe,SAAP;EAAA,IAAkBC,YAAlB;;EACA,iBAA2B,IAAAhB,eAAA,EAASF,SAAT,CAA3B;EAAA,IAAOmB,gBAAP;;EAEA,IAAAC,gBAAA,EAAU,YAAM;IACd;IACA,IAAMC,cAAc,GAAGC,WAAW,CAAC,YAAM;MACvCV,qBAAqB,CAACW,sBAAsB,CAAC,IAAIC,IAAJ,GAAWC,OAAX,EAAD,CAAvB,CAArB;IACD,CAFiC,EAE/B,IAF+B,CAAlC;IAIA,OAAO,YAAM;MACXC,aAAa,CAACL,cAAD,CAAb;IACD,CAFD;EAGD,CATD,EASG,EATH;EAWA,IAAAD,gBAAA,EAAU,YAAM;IACd,IAAMO,MAAM,GAAG,EAAf;IACA,IAAMC,SAAiB,GAAG,IAAAC,kBAAA,EAAY7B,SAAZ,CAA1B;;IAFc,2BAGL8B,CAHK;MAIZH,MAAM,CAACI,IAAP,CAAY;QACVC,cAAc,EAAE,CAACJ,SAAS,GAAGE,CAAC,GAAG,IAAJ,GAAW,IAAxB,EAA8BF,SAAS,GAAG,CAACE,CAAC,GAAG,CAAL,IAAU,IAAV,GAAiB,IAA3D,CADN;QAEVG,QAAQ,EAAEtC,IAAF,oBAAEA,IAAI,CAAEuC,MAAN,CAAa,UAACC,IAAD,EAAU;UAC/B,OACEA,IAAI,CAACtC,mBAAmB,CAAC,CAAD,CAApB,CAAJ,IAAgC+B,SAAS,GAAGE,CAAC,GAAG,IAAJ,GAAW,IAAvD,IACAK,IAAI,CAACtC,mBAAmB,CAAC,CAAD,CAApB,CAAJ,GAA+B+B,SAAS,GAAG,CAACE,CAAC,GAAG,CAAL,IAAU,IAAV,GAAiB,IAF9D;QAID,CALS;MAFA,CAAZ;IAJY;;IAGd,KAAK,IAAIA,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzB,SAAS,CAAC+B,MAA9B,EAAsCN,CAAC,EAAvC,EAA2C;MAAA,MAAlCA,CAAkC;IAU1C;;IACD,IAAMO,YAA4B,GAAGC,uBAAuB,EAA5D;IACA/B,eAAe,CAACoB,MAAD,CAAf;IACA,OAAO,YAAM;MACXY,YAAY,CAACF,YAAD,CAAZ;IACD,CAFD;EAGD,CAnBD,EAmBG,CAAC1C,IAAD,EAAOK,SAAP,CAnBH;EAqBA,IAAAoB,gBAAA,EAAU,YAAM;IACd,IAAMoB,aAAa,GAAGC,QAAQ,CAACC,sBAAT,sCAAtB;;IACA,IAAIF,aAAa,CAAC,CAAD,CAAjB,EAAsB;MAAA;;MACpB1B,iBAAiB,oBAAC0B,aAAa,CAAC,CAAD,CAAd,qBAAC,gBAAkBG,WAAnB,CAAjB;IACD,CAFD,MAEO;MACL7B,iBAAiB,CAAC,CAAD,CAAjB;IACD;EACF,CAPD,EAOG,CAACR,YAAD,EAAeZ,cAAf,EAA+BM,SAA/B,CAPH,EAxEI,CAiFJ;;EACA,IAAMsC,uBAA6C,GAAG,SAAhDA,uBAAgD,GAAM;IAC1D,OAAOM,UAAU,CAAC,YAAM;MACtB,IAAI;QAAA;;QACF,IAAMC,kBAAkB,GAAGJ,QAAQ,CAACK,cAAT,CAAwB,qCAAxB,CAA3B;QACA,IAAMC,YAAoB,GACxB,IAAAvC,kBAAA,EACK,IAAAwC,cAAA,EAAQ7B,gBAAR,CADL,SACkC,IAAA8B,eAAA,EAAS9B,gBAAT,CADlC,SACgE,IAAA+B,aAAA,EAC5D/B,gBAD4D,CADhE,SAGO,IAAAX,kBAAA,EAAOW,gBAAP,EAAyBV,IAAzB,EAHP,aAIE0C,IAJF,KAIW,IALb;QAMAN,kBAAkB,CAACO,SAAnB,GACE,0BAAAX,QAAQ,CAACK,cAAT,MAA2BC,YAA3B,4CAA4CM,SAA5C,IAAwDpD,MAAM,GAAG,CADnE;MAED,CAVD,CAUE,OAAOqD,GAAP,EAAY;QACZC,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BF,GAA3B;MACD;IACF,CAdgB,EAcd,EAdc,CAAjB;EAeD,CAhBD,CAlFI,CAoGJ;;;EACA,IAAMG,iBAA8B,GAAG,IAAAC,cAAA,EACrC;IAAA,oBACE;MACE,EAAE,EAAC,qCADL;MAEE,QAAQ,EAAE,kBAACC,CAAD;QAAA;;QAAA,OAAOvD,eAAe,CAAC,aAAEuD,CAAD,CAAWC,MAAZ,qBAAC,QAAmBR,SAApB,CAAD,CAAtB;MAAA,CAFZ;MAGE,SAAS,EAAES,iBAAA,CAAMC;IAHnB,GAKGxD,YALH,oBAKGA,YAAY,CAAEyD,GAAd,CAAkB,UAAC5B,IAAD,EAAO6B,KAAP;MAAA,oBACjB,gCAAC,wBAAD;QACE,mBAAmB,EAAEnE,mBADvB;QAEE,YAAY,EAAEqB,YAFhB;QAGE,WAAW,EAAEF,WAHf;QAIE,aAAa,EAAEpB,aAJjB;QAKE,EAAE,OAAKuC,IAAI,CAACH,cAAL,CAAoB,CAApB,CALT;QAME,KAAK,EAAEnB,cAAc,KAAK,CAAnB,GAAuB,CAAvB,GAA2BA,cAAc,GAAG,CANrD;QAOE,GAAG,EAAEmD,KAPP;QAQE,cAAc,EAAEC,IAAI,CAACC,GAAL,CAASC,KAAT,CACd,IADc,EAEd7D,YAFc,oBAEdA,YAAY,CAAEyD,GAAd,CAAkB,UAACK,CAAD;UAAA;;UAAA,OAAOA,CAAP,mCAAOA,CAAC,CAAEnC,QAAV,qBAAO,YAAaG,MAApB;QAAA,CAAlB,CAFc,CARlB;QAYE,QAAQ,EAAED,IAAI,CAACF,QAZjB;QAaE,cAAc,EAAEvC,cAblB;QAcE,cAAc,EAAEyC,IAAI,CAACH;MAdvB,EADiB;IAAA,CAAlB,CALH,CADF;EAAA,CADqC,EA2BrC,CAAC1B,YAAD,EAAeZ,cAAf,EAA+BmB,cAA/B,CA3BqC,CAAvC,CArGI,CAmIJ;;EACA,IAAMwD,cAA2B,GAAG,IAAAX,cAAA,EAClC;IAAA,oBACE;MACE,SAAS,EAAEG,iBAAA,CAAMS,iBADnB;MAEE,KAAK,EAAE;QAAErE,MAAM,EAAKI,SAAS,CAAC+B,MAAV,GAAmB,EAAxB,OAAR;QAAwCmC,GAAG,EAAEpE;MAA7C;IAFT,gBAIE;MAAK,KAAK,EAAE;QAAEqE,QAAQ,EAAE;MAAZ;IAAZ,GACGnE,SAAS,CAAC0D,GAAV,CAAc,UAACU,CAAD,EAAIT,KAAJ;MAAA,oBACb;QAAK,SAAS,EAAEH,iBAAA,CAAMa,sBAAtB;QAA8C,GAAG,EAAEV;MAAnD,gBACE;QAAM,SAAS,EAAEH,iBAAA,CAAMc,sBAAvB;QAA+C,KAAK,EAAE;UAAEJ,GAAG,EAAEP,KAAK,KAAK,CAAV,IAAe,CAAC;QAAvB;MAAtD,IACMS,CAAC,GAAG,EAAJ,SAAaA,CAAb,GAAmBA,CADzB,UADF,CADa;IAAA,CAAd,CADH,CAJF,CADF;EAAA,CADkC,EAiBlC,CAACtE,YAAD,CAjBkC,CAApC,CApII,CAwJJ;;EACA,IAAMyE,cAA2B,GAAG,IAAAlB,cAAA,EAClC;IAAA,oBAAM,gCAAC,0BAAD;MAAgB,SAAS,EAAEzC,SAA3B;MAAsC,YAAY,EAAEd,YAApD;MAAkE,MAAM,EAAEY;IAA1E,EAAN;EAAA,CADkC,EAElC,CAACE,SAAD,EAAYd,YAAZ,EAA0BY,QAA1B,CAFkC,CAApC;;EAKA,IAAM8D,kBAA+C,GAAG,SAAlDA,kBAAkD,CAACC,MAAD;IAAA,OACtD,IAAAjD,kBAAA,EAAYiD,MAAZ,KAAuB,IAAItD,IAAJ,GAAWC,OAAX,EAAvB,IACA,IAAID,IAAJ,GAAWC,OAAX,KAAuB,IAAAI,kBAAA,EAAYiD,MAAM,GAAG,OAAO,EAAP,GAAY,IAAjC,CAF+B;EAAA,CAAxD;;EAIA,IAAMvD,sBAAkD,GAAG,SAArDA,sBAAqD,CAACuD,MAAD;IAAA,OACzD,CAAC,IAAAtE,kBAAA,EAAOsE,MAAP,EAAerE,IAAf,KAAwB,EAAxB,GAA6B,IAAAD,kBAAA,EAAOsE,MAAP,EAAepE,MAAf,EAA9B,IAAyD,CADA;EAAA,CAA3D;;EAGA,oBACE;IACE,SAAS,EAAEmD,iBAAA,CAAMkB,mCADnB;IAEE,KAAK,EAAE;MAAE9E,MAAM,EAAKA,MAAM,GAAG,GAAd;IAAR;EAFT,gBAIE,kEACGoE,cADH,EAEGZ,iBAFH,EAGGmB,cAHH,EAIGC,kBAAkB,CAAC7E,SAAD,CAAlB,iBACC;IACE,SAAS,EAAE6D,iBAAA,CAAMmB,0CADnB;IAEE,KAAK,EAAE;MAAET,GAAG,EAAK5D,kBAAkB,GAAGR,YAA1B;IAAL;EAFT,gBAIE;IAAK,SAAS,EAAE0D,iBAAA,CAAMoB;EAAtB,EAJF,CALJ,CAJF,CADF;AAoBD,CA9LD;;eAgMexF,iB"}