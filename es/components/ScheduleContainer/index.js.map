{"version":3,"file":"index.js","names":["moment","style","React","useContext","useEffect","useMemo","useState","getZeroTime","ScheduleItem","MovingBaseLine","GlobalData","useAutoScroll","TimeScale","ScheduleContainer","scheduleRender","data","rangeStartAndEndKey","targetDay","height","scrollHeight","setScrollHeight","HoursList","scheduleList","setScheduleList","hour","minute","currTimeLineHeight","setCurrTimeLineHeight","containerWidth","setContainerWidth","isMoving","setIsMoving","movingTop","setMovingTop","timeLineTimeID","setInterval","calcCurrTimeLineHeight","Date","getTime","clearInterval","result","todayTime","i","push","timestampRange","dataItem","filter","item","length","containerList","document","getElementsByClassName","clientWidth","memo_ScheduleItem","e","target","scrollTop","WT_Calendar_ScheduleContainer_inner","map","index","Math","max","apply","x","isShowCurrTimeLine","params","WT_Calendar_ScheduleContainer_outer","WT_Calendar_ScheduleContainer_currTimeLine","top","WT_Calendar_ScheduleContainer_startPoint"],"sources":["../../../src/components/ScheduleContainer/index.tsx"],"sourcesContent":["import moment from 'moment';\r\nimport style from './index.less';\r\nimport React, {useContext, useEffect, useMemo, useState} from 'react';\r\nimport { getDay, getMonth, getYear, getZeroTime } from '@/utils';\r\nimport ScheduleItem from '@/components/ScheduleItem';\r\nimport MovingBaseLine from '@/components/ScheduleContainer/components/MovingBaseLine';\r\nimport type { ScheduleContainerType, HourType, scheduleListType } from '@/data.d';\r\nimport {GlobalData} from \"@/components/Container\";\r\nimport {useAutoScroll} from \"@/hooks/useAutoScroll\";\r\nimport TimeScale from \"@/components/ScheduleContainer/components/TimeScale\";\r\n\r\nconst ScheduleContainer: React.FC<ScheduleContainerType> = ({\r\n  scheduleRender,\r\n  data,\r\n  rangeStartAndEndKey,\r\n}) => {\r\n  const {targetDay, height} = useContext(GlobalData);\r\n  // 同步滚动高度使用\r\n  const [scrollHeight, setScrollHeight] = useState<number>(0);\r\n  const [HoursList] = useState<HourType>([\r\n    0,\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    6,\r\n    7,\r\n    8,\r\n    9,\r\n    10,\r\n    11,\r\n    12,\r\n    13,\r\n    14,\r\n    15,\r\n    16,\r\n    17,\r\n    18,\r\n    19,\r\n    20,\r\n    21,\r\n    22,\r\n    23,\r\n    0,\r\n  ]);\r\n  const [scheduleList, setScheduleList] = useState<scheduleListType[]>([]);\r\n  const [currTimeLineHeight, setCurrTimeLineHeight] = useState<number>(\r\n    () => (moment(targetDay).hour() * 60 + moment(targetDay).minute()) / 2,\r\n  );\r\n  const [containerWidth, setContainerWidth] = useState<number>(0);\r\n  const [isMoving, setIsMoving] = useState<boolean>(false);\r\n  const [movingTop, setMovingTop] = useState<number>(0);\r\n\r\n  useEffect(() => {\r\n    // 当前时间线计时器\r\n    const timeLineTimeID = setInterval(() => {\r\n      setCurrTimeLineHeight(calcCurrTimeLineHeight(new Date().getTime()));\r\n    }, 1000);\r\n\r\n    return () => {\r\n      clearInterval(timeLineTimeID);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const result = [];\r\n    const todayTime: number = getZeroTime(targetDay) as number;\r\n    for (let i = 0; i < HoursList.length; i++) {\r\n      result.push({\r\n        timestampRange: [todayTime + i * 3600 * 1000, todayTime + (i + 1) * 3600 * 1000],\r\n        dataItem: data?.filter((item) => {\r\n          return (\r\n            item[rangeStartAndEndKey[0]] >= todayTime + i * 3600 * 1000 &&\r\n            item[rangeStartAndEndKey[0]] < todayTime + (i + 1) * 3600 * 1000\r\n          );\r\n        }),\r\n      });\r\n    }\r\n    setScheduleList(result);\r\n  }, [data, targetDay]);\r\n\r\n  useAutoScroll(targetDay, height)\r\n\r\n  useEffect(() => {\r\n    const containerList = document.getElementsByClassName(`WT_Calendar_ScheduleItem_container`);\r\n    if (containerList[0]) {\r\n      setContainerWidth(containerList[0]?.clientWidth);\r\n    } else {\r\n      setContainerWidth(0);\r\n    }\r\n  }, [scheduleList, scheduleRender, targetDay]);\r\n\r\n  // 日程组件Item\r\n  const memo_ScheduleItem: JSX.Element = useMemo(\r\n    () => (\r\n      <div\r\n        id=\"WT_Calendar_ScheduleContainer_inner\"\r\n        onScroll={(e) => setScrollHeight(-(e as any).target?.scrollTop)}\r\n        className={style.WT_Calendar_ScheduleContainer_inner}\r\n      >\r\n        {scheduleList?.map((item, index) => (\r\n          <ScheduleItem\r\n            rangeStartAndEndKey={rangeStartAndEndKey}\r\n            setMovingTop={setMovingTop}\r\n            setIsMoving={setIsMoving}\r\n            id={`${item.timestampRange[0]}`}\r\n            width={containerWidth === 0 ? 0 : containerWidth + 4}\r\n            key={index}\r\n            dataItemLength={Math.max.apply(\r\n              null,\r\n              scheduleList?.map((x) => x?.dataItem?.length),\r\n            )}\r\n            dataItem={item.dataItem}\r\n            scheduleRender={scheduleRender}\r\n            timestampRange={item.timestampRange}\r\n          />\r\n        ))}\r\n      </div>\r\n    ),\r\n    [scheduleList, scheduleRender, containerWidth],\r\n  );\r\n\r\n  const isShowCurrTimeLine: (params: number) => boolean = (params) =>\r\n    getZeroTime(params) <= new Date().getTime() &&\r\n    new Date().getTime() < getZeroTime(params + 3600 * 24 * 1000);\r\n\r\n  const calcCurrTimeLineHeight: (params: number) => number = (params) =>\r\n    (moment(params).hour() * 60 + moment(params).minute()) / 2;\r\n\r\n  return (\r\n    <div\r\n      className={style.WT_Calendar_ScheduleContainer_outer}\r\n      style={{ height: `${height - 155}px` }}\r\n    >\r\n      <>\r\n        <TimeScale HoursList={HoursList} scrollHeight={scrollHeight}/>\r\n        {memo_ScheduleItem}\r\n        {\r\n          isMoving && <MovingBaseLine movingTop={movingTop} scrollHeight={scrollHeight} color=\"#1890ff\" />\r\n        }\r\n        {isShowCurrTimeLine(targetDay) && (\r\n          <div\r\n            className={style.WT_Calendar_ScheduleContainer_currTimeLine}\r\n            style={{ top: `${currTimeLineHeight + scrollHeight}px` }}\r\n          >\r\n            <div className={style.WT_Calendar_ScheduleContainer_startPoint} />\r\n          </div>\r\n        )}\r\n      </>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ScheduleContainer;\r\n"],"mappings":"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"}