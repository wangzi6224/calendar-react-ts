{"version":3,"file":"index.js","names":["moment","style","React","useContext","useEffect","useMemo","useState","getZeroTime","ScheduleItem","MovingBaseLine","GlobalData","useAutoScroll","TimeScale","ScheduleContainer","scheduleRender","data","rangeStartAndEndKey","targetDay","height","scrollHeight","setScrollHeight","HoursList","scheduleList","setScheduleList","hour","minute","currTimeLineHeight","setCurrTimeLineHeight","containerWidth","setContainerWidth","isMoving","setIsMoving","movingTop","setMovingTop","timeLineTimeID","setInterval","calcCurrTimeLineHeight","Date","getTime","clearInterval","result","todayTime","i","push","timestampRange","dataItem","filter","item","length","containerList","document","getElementsByClassName","clientWidth","memo_ScheduleItem","e","target","scrollTop","Calendar_ScheduleContainer_inner","map","index","Math","max","apply","x","isShowCurrTimeLine","params","Calendar_ScheduleContainer_outer","Calendar_ScheduleContainer_currTimeLine","top","Calendar_ScheduleContainer_startPoint"],"sources":["../../../src/components/ScheduleContainer/index.tsx"],"sourcesContent":["import moment from 'moment';\nimport style from './index.less';\nimport React, {useContext, useEffect, useMemo, useState} from 'react';\nimport { getDay, getMonth, getYear, getZeroTime } from '@/utils';\nimport ScheduleItem from '@/components/ScheduleItem';\nimport MovingBaseLine from '@/components/ScheduleContainer/components/MovingBaseLine';\nimport type { ScheduleContainerType, HourType, scheduleListType } from '@/data.d';\nimport {GlobalData} from \"@/components/Container\";\nimport {useAutoScroll} from \"@/hooks/useAutoScroll\";\nimport TimeScale from \"@/components/ScheduleContainer/components/TimeScale\";\n\nconst ScheduleContainer: React.FC<ScheduleContainerType> = ({\n  scheduleRender,\n  data,\n  rangeStartAndEndKey,\n}) => {\n  const {targetDay, height} = useContext(GlobalData);\n  // 同步滚动高度使用\n  const [scrollHeight, setScrollHeight] = useState<number>(0);\n  const [HoursList] = useState<HourType>([\n    0,\n    1,\n    2,\n    3,\n    4,\n    5,\n    6,\n    7,\n    8,\n    9,\n    10,\n    11,\n    12,\n    13,\n    14,\n    15,\n    16,\n    17,\n    18,\n    19,\n    20,\n    21,\n    22,\n    23,\n    0,\n  ]);\n  const [scheduleList, setScheduleList] = useState<scheduleListType[]>([]);\n  const [currTimeLineHeight, setCurrTimeLineHeight] = useState<number>(\n    () => (moment(targetDay).hour() * 60 + moment(targetDay).minute()) / 2,\n  );\n  const [containerWidth, setContainerWidth] = useState<number>(0);\n  const [isMoving, setIsMoving] = useState<boolean>(false);\n  const [movingTop, setMovingTop] = useState<number>(0);\n\n  useEffect(() => {\n    // 当前时间线计时器\n    const timeLineTimeID = setInterval(() => {\n      setCurrTimeLineHeight(calcCurrTimeLineHeight(new Date().getTime()));\n    }, 1000);\n\n    return () => {\n      clearInterval(timeLineTimeID);\n    };\n  }, []);\n\n  useEffect(() => {\n    const result = [];\n    const todayTime: number = getZeroTime(targetDay) as number;\n    for (let i = 0; i < HoursList.length; i++) {\n      result.push({\n        timestampRange: [todayTime + i * 3600 * 1000, todayTime + (i + 1) * 3600 * 1000],\n        dataItem: data?.filter((item) => {\n          return (\n            item[rangeStartAndEndKey[0]] >= todayTime + i * 3600 * 1000 &&\n            item[rangeStartAndEndKey[0]] < todayTime + (i + 1) * 3600 * 1000\n          );\n        }),\n      });\n    }\n    setScheduleList(result);\n  }, [data, targetDay]);\n\n  useAutoScroll(targetDay, height)\n\n  useEffect(() => {\n    const containerList = document.getElementsByClassName(`Calendar_ScheduleItem_container`);\n    if (containerList[0]) {\n      setContainerWidth(containerList[0]?.clientWidth);\n    } else {\n      setContainerWidth(0);\n    }\n  }, [scheduleList, scheduleRender, targetDay]);\n\n  // 日程组件Item\n  const memo_ScheduleItem: JSX.Element = useMemo(\n    () => (\n      <div\n        id=\"Calendar_ScheduleContainer_inner\"\n        onScroll={(e) => setScrollHeight(-(e as any).target?.scrollTop)}\n        className={style.Calendar_ScheduleContainer_inner}\n      >\n        {scheduleList?.map((item, index) => (\n          <ScheduleItem\n            rangeStartAndEndKey={rangeStartAndEndKey}\n            setMovingTop={setMovingTop}\n            setIsMoving={setIsMoving}\n            id={`${item.timestampRange[0]}`}\n            width={containerWidth === 0 ? 0 : containerWidth + 4}\n            key={index}\n            dataItemLength={Math.max.apply(\n              null,\n              scheduleList?.map((x) => x?.dataItem?.length),\n            )}\n            dataItem={item.dataItem}\n            scheduleRender={scheduleRender}\n            timestampRange={item.timestampRange}\n          />\n        ))}\n      </div>\n    ),\n    [scheduleList, scheduleRender, containerWidth],\n  );\n\n  const isShowCurrTimeLine: (params: number) => boolean = (params) =>\n    getZeroTime(params) <= new Date().getTime() &&\n    new Date().getTime() < getZeroTime(params + 3600 * 24 * 1000);\n\n  const calcCurrTimeLineHeight: (params: number) => number = (params) =>\n    (moment(params).hour() * 60 + moment(params).minute()) / 2;\n\n  return (\n    <div\n      className={style.Calendar_ScheduleContainer_outer}\n      style={{ height: `${height - 155}px` }}\n    >\n      <>\n        <TimeScale HoursList={HoursList} scrollHeight={scrollHeight}/>\n        {memo_ScheduleItem}\n        <MovingBaseLine movingTop={movingTop} scrollHeight={scrollHeight} color=\"#1890ff\" visibility={isMoving} />\n        {isShowCurrTimeLine(targetDay) && (\n          <div\n            className={style.Calendar_ScheduleContainer_currTimeLine}\n            style={{ top: `${currTimeLineHeight + scrollHeight}px` }}\n          >\n            <div className={style.Calendar_ScheduleContainer_startPoint} />\n          </div>\n        )}\n      </>\n    </div>\n  );\n};\n\nexport default ScheduleContainer;\n"],"mappings":"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"}