{"version":3,"file":"index.js","names":["React","Fragment","useContext","useRef","style","moment","GlobalData","isClick","initMouseTop","initOffsetTop","dataIndex","timeId","containerInitHeight","ScheduleItem","timestampRange","dataItem","scheduleRender","width","dataItemLength","id","setIsMoving","setMovingTop","rangeStartAndEndKey","targetDay","isDraggable","changeScheduleDataHandle","calcHeight","timestampList","length","calcTop","startTime","minute","calcWidth","w","d","ref","mouseDownHandle","e","index","persist","setTimeout","targetEle","current","clientY","position","top","document","getElementById","offsetTop","body","addEventListener","onMouseMove","mouseUpHandle","requestAnimationFrame","currMouseOffset","err","console","log","currentTimeStamp","format","Math","floor","unix","timeDiff","removeEventListener","timeRangeShow","params","changeRangeMouseMove","ev","height","getHeightAttrNumber","replace","rangeChangeHandle","data","stopPropagation","rangeChangeMouseUp","containerHeight","WT_Calendar_ScheduleItem_Fath","WT_Calendar_ScheduleItem","map","clearTimeout","WT_Calendar_ScheduleItem_container","WT_Calendar_ScheduleItem_bottomLine"],"sources":["../../../src/components/ScheduleItem/index.tsx"],"sourcesContent":["import React, {Fragment, useContext, useRef} from 'react';\r\nimport style from './index.less';\r\nimport moment from 'moment';\r\nimport type {dataType, ScheduleItemType} from '@/data.d';\r\nimport {GlobalData} from \"@/components/Container\";\r\n\r\nlet isClick = false;\r\nlet initMouseTop = 0;\r\nlet initOffsetTop = 0;\r\nlet dataIndex: number = null;\r\nlet timeId = null;\r\nlet containerInitHeight = 0;\r\n\r\nconst ScheduleItem: React.FC<ScheduleItemType> = ({\r\n  timestampRange,\r\n  dataItem,\r\n  scheduleRender,\r\n  width,\r\n  dataItemLength,\r\n  id,\r\n  setIsMoving,\r\n  setMovingTop,\r\n  rangeStartAndEndKey,\r\n}) => {\r\n  const {targetDay, isDraggable, changeScheduleDataHandle} = useContext(GlobalData);\r\n  // 计算容器高度\r\n  const calcHeight: (timestampList: [number, number]) => number = (timestampList) =>\r\n    timestampList.length > 1 ? (timestampList[1] - timestampList[0]) / 1000 / 60 / 2 : 30;\r\n  const calcTop: (startTime: number) => number = (startTime) => moment(startTime).minute() / 2;\r\n  // 计算 ScheduleItem 宽度\r\n  const calcWidth: (w: number, d: number) => string = (w, d) =>\r\n    width === 0 || dataItemLength * width < 347 ? '100%' : `${d * w}px`;\r\n  const ref = useRef<HTMLDivElement>();\r\n\r\n  // 按下鼠标\r\n  const mouseDownHandle = (e, index) => {\r\n    if (!isDraggable) return;\r\n    e.persist();\r\n    timeId = setTimeout(() => {\r\n      dataIndex = index;\r\n      const targetEle = ref.current;\r\n      initMouseTop = e.clientY;\r\n      targetEle.style.position = 'absolute';\r\n      targetEle.style.top = `${document.getElementById(id).offsetTop + targetEle.offsetTop}px`;\r\n      initOffsetTop = targetEle.offsetTop;\r\n      isClick = true;\r\n      setIsMoving(true);\r\n      document.body.addEventListener('mousemove', onMouseMove);\r\n      document.body.addEventListener('mouseup', mouseUpHandle);\r\n    }, 200);\r\n  };\r\n\r\n  // 移动鼠标\r\n  const onMouseMove = (e) => {\r\n    try {\r\n      requestAnimationFrame(() => {\r\n        if (isClick) {\r\n          const targetEle = ref.current;\r\n          const currMouseOffset = e.clientY - initMouseTop;\r\n          targetEle.style.top = `${\r\n            initOffsetTop + currMouseOffset <= 0 ? 0 : initOffsetTop + currMouseOffset\r\n          }px`;\r\n          setMovingTop(initOffsetTop + currMouseOffset === 0 ? 0 : initOffsetTop + currMouseOffset);\r\n        }\r\n      })\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  // 抬起鼠标\r\n  const mouseUpHandle = () => {\r\n    try {\r\n      if (isClick) {\r\n        setIsMoving(false);\r\n        isClick = false;\r\n        const targetEle = ref.current;\r\n        const currentTimeStamp =\r\n          moment(\r\n            `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\r\n              targetEle.offsetTop / 30,\r\n            )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\r\n          ).unix() * 1000;\r\n        const timeDiff =\r\n          dataItem[dataIndex][rangeStartAndEndKey[1]] - dataItem[dataIndex][rangeStartAndEndKey[0]];\r\n        changeScheduleDataHandle([currentTimeStamp, currentTimeStamp + timeDiff], dataItem[dataIndex]);\r\n      }\r\n      document.body.removeEventListener('mousemove', onMouseMove);\r\n      document.body.removeEventListener('mouseup', mouseUpHandle);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const timeRangeShow = (params: dataType):boolean => (\r\n    params[rangeStartAndEndKey[0]] >= timestampRange[0] &&\r\n    params[rangeStartAndEndKey[0]] < timestampRange[1]\r\n  );\r\n\r\n  const changeRangeMouseMove = (ev) => {\r\n    requestAnimationFrame(() => {\r\n      const currMouseOffset = ev.clientY - initMouseTop;\r\n      ref.current.style.height = `${containerInitHeight + currMouseOffset}px`\r\n    })\r\n  };\r\n\r\n  const getHeightAttrNumber = (height: string): number => {\r\n    return +height.replace(/[^\\d.-]/g, '')\r\n  };\r\n\r\n  const rangeChangeHandle = (ev, data, index) => {\r\n    ev.stopPropagation();\r\n    dataIndex = index;\r\n    initMouseTop = ev.clientY;\r\n    containerInitHeight = getHeightAttrNumber(ref.current.style.height);\r\n    document.body.addEventListener('mousemove', changeRangeMouseMove);\r\n    document.body.addEventListener('mouseup', rangeChangeMouseUp);\r\n  }\r\n\r\n  const rangeChangeMouseUp = () => {\r\n    const targetEle = ref.current;\r\n    const currentTimeStamp =\r\n      moment(\r\n        `${moment(targetDay).format('YYYY-MM-DD')} ${Math.floor(\r\n          targetEle.offsetTop / 30,\r\n        )}:${Math.floor(((targetEle.offsetTop / 30) * 60) % 60)}:00`,\r\n      ).unix() * 1000;\r\n    const containerHeight = getHeightAttrNumber(ref.current.style.height);\r\n    changeScheduleDataHandle([currentTimeStamp, currentTimeStamp + containerHeight * 2 * 60 * 1000], dataItem[dataIndex]);\r\n    document.body.removeEventListener('mousemove', changeRangeMouseMove);\r\n    document.body.removeEventListener('mouseup', rangeChangeMouseUp);\r\n  }\r\n\r\n  return (\r\n    <div id={id} className={style.WT_Calendar_ScheduleItem_Fath}>\r\n      <div\r\n        className={style.WT_Calendar_ScheduleItem}\r\n        style={{ width: calcWidth(width, dataItemLength) }}\r\n      >\r\n        {dataItem?.map((data, index) => {\r\n          return (\r\n            <Fragment key={`${data[rangeStartAndEndKey[0]]}${index}`}>\r\n              {timeRangeShow(data) && (\r\n                  <div\r\n                    ref={ref}\r\n                    key={`${data[rangeStartAndEndKey[0]]}${index}`}\r\n                    id={`${data[rangeStartAndEndKey[0]]}${index}`}\r\n                    onMouseDown={(ev) => mouseDownHandle(ev, index)}\r\n                    onMouseUp={() => {\r\n                      if(isDraggable) {\r\n                        clearTimeout(timeId);\r\n                      }\r\n                    }}\r\n                    className={`${style.WT_Calendar_ScheduleItem_container}`}\r\n                    style={{\r\n                      height: `${\r\n                        calcHeight([data[rangeStartAndEndKey[0]], data[rangeStartAndEndKey[1]]]) ||\r\n                        30\r\n                      }px`,\r\n                      top: calcTop(data[rangeStartAndEndKey[0]]),\r\n                    }}\r\n                  >\r\n                    {scheduleRender({ data, timestampRange })}\r\n                    <div\r\n                      onMouseDown={(ev) => {\r\n                        rangeChangeHandle(ev, data, index)\r\n                      }}\r\n                      onMouseUp={rangeChangeMouseUp}\r\n                      className={style.WT_Calendar_ScheduleItem_bottomLine}\r\n                    />\r\n                  </div>\r\n                )}\r\n            </Fragment>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ScheduleItem;\r\n"],"mappings":"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"}