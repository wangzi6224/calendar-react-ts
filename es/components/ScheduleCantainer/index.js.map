{"version":3,"file":"index.js","names":["moment","style","React","useContext","useEffect","useMemo","useState","getDay","getMonth","getYear","getZeroTime","ScheduleItem","MovingBaseLine","GlobalData","ScheduleCantainer","scheduleRender","data","onSlideChange","rangeStartAndEndKey","targetDay","height","scrollHeight","setScrollHeight","HoursList","scheduleList","setScheduleList","hour","minute","currTimeLineHeight","setCurrTimeLineHeight","containerWidth","setContainerWidth","isMoving","setIsMoving","movingTop","setMovingTop","autoPositionTime","timeLineTimeID","setInterval","calcCurrTimeLineHeight","Date","getTime","clearInterval","resule","todayTime","i","push","timestampRange","dataItem","filter","item","length","scrollTimeID","autoPositonScrollHandle","clearTimeout","containerList","document","getElementsByClassName","clientWidth","setTimeout","scrollContainerEle","getElementById","PositionTime","unix","scrollTop","offsetTop","err","console","log","memo_ScheduleItem","e","target","WT_Calendar_ScheduleCantainer_inner","map","index","Math","max","apply","x","memo_TimeScale","WT_Calendar_scale","top","position","h","WT_Calendar_scale_item","WT_Calendar_scale_text","movingBaseLine","isShowCurrTimeLine","params","WT_Calendar_ScheduleCantainer_outer","WT_Calendar_ScheduleCantainer_currTimeLine","WT_Calendar_ScheduleCantainer_startPoint"],"sources":["../../../src/components/ScheduleCantainer/index.tsx"],"sourcesContent":["import moment from 'moment';\nimport style from './index.less';\nimport React, {useContext, useEffect, useMemo, useState} from 'react';\nimport { getDay, getMonth, getYear, getZeroTime } from '@/utils';\nimport ScheduleItem from '@/components/ScheduleItem';\nimport MovingBaseLine from '@/components/ScheduleCantainer/MovingBaseLine';\nimport type { ScheduleCantainerType, HourType, scheduleListType } from '@/data.d';\nimport {GlobalData} from \"@/components/Container\";\n\nconst ScheduleCantainer: React.FC<ScheduleCantainerType> = ({\n  scheduleRender,\n  data,\n  onSlideChange,\n  rangeStartAndEndKey,\n}) => {\n  const {targetDay, height} = useContext(GlobalData);\n  // 同步滚动高度使用\n  const [scrollHeight, setScrollHeight] = useState<number>(0);\n  const [HoursList] = useState<HourType>([\n    0,\n    1,\n    2,\n    3,\n    4,\n    5,\n    6,\n    7,\n    8,\n    9,\n    10,\n    11,\n    12,\n    13,\n    14,\n    15,\n    16,\n    17,\n    18,\n    19,\n    20,\n    21,\n    22,\n    23,\n    0,\n  ]);\n  const [scheduleList, setScheduleList] = useState<scheduleListType[]>([]);\n  const [currTimeLineHeight, setCurrTimeLineHeight] = useState<number>(\n    () => (moment(targetDay).hour() * 60 + moment(targetDay).minute()) / 2,\n  );\n  const [containerWidth, setContainerWidth] = useState<number>(0);\n  const [isMoving, setIsMoving] = useState<boolean>(false);\n  const [movingTop, setMovingTop] = useState<number>(0);\n  const [autoPositionTime] = useState(targetDay);\n\n  useEffect(() => {\n    // 当前时间线计时器\n    const timeLineTimeID = setInterval(() => {\n      setCurrTimeLineHeight(calcCurrTimeLineHeight(new Date().getTime()));\n    }, 1000);\n\n    return () => {\n      clearInterval(timeLineTimeID);\n    };\n  }, []);\n\n  useEffect(() => {\n    const resule = [];\n    const todayTime: number = getZeroTime(targetDay) as number;\n    for (let i = 0; i < HoursList.length; i++) {\n      resule.push({\n        timestampRange: [todayTime + i * 3600 * 1000, todayTime + (i + 1) * 3600 * 1000],\n        dataItem: data?.filter((item) => {\n          return (\n            item[rangeStartAndEndKey[0]] >= todayTime + i * 3600 * 1000 &&\n            item[rangeStartAndEndKey[0]] < todayTime + (i + 1) * 3600 * 1000\n          );\n        }),\n      });\n    }\n    const scrollTimeID: NodeJS.Timeout = autoPositonScrollHandle();\n    setScheduleList(resule);\n    return () => {\n      clearTimeout(scrollTimeID);\n    };\n  }, [data, targetDay]);\n\n  useEffect(() => {\n    const containerList = document.getElementsByClassName(`WT_Calendar_ScheduleItem_container`);\n    if (containerList[0]) {\n      setContainerWidth(containerList[0]?.clientWidth);\n    } else {\n      setContainerWidth(0);\n    }\n  }, [scheduleList, scheduleRender, targetDay]);\n\n  // 自动滚动到定位的日程\n  const autoPositonScrollHandle: () => NodeJS.Timeout = () => {\n    return setTimeout(() => {\n      try {\n        const scrollContainerEle = document.getElementById('WT_Calendar_ScheduleCantainer_inner');\n        const PositionTime: number =\n          moment(\n            `${getYear(autoPositionTime)}/${getMonth(autoPositionTime)}/${getDay(\n              autoPositionTime,\n            )} ${moment(autoPositionTime).hour()}:00:00`,\n          ).unix() * 1000;\n        scrollContainerEle.scrollTop =\n          document.getElementById(`${PositionTime}`)?.offsetTop - height / 3;\n      } catch (err) {\n        console.log('自动滚动报错---->', err);\n      }\n    }, 20);\n  };\n\n  // 日程组件Item\n  const memo_ScheduleItem: JSX.Element = useMemo(\n    () => (\n      <div\n        id=\"WT_Calendar_ScheduleCantainer_inner\"\n        onScroll={(e) => setScrollHeight(-(e as any).target?.scrollTop)}\n        className={style.WT_Calendar_ScheduleCantainer_inner}\n      >\n        {scheduleList?.map((item, index) => (\n          <ScheduleItem\n            rangeStartAndEndKey={rangeStartAndEndKey}\n            setMovingTop={setMovingTop}\n            setIsMoving={setIsMoving}\n            onSlideChange={onSlideChange}\n            id={`${item.timestampRange[0]}`}\n            width={containerWidth === 0 ? 0 : containerWidth + 4}\n            key={index}\n            dataItemLength={Math.max.apply(\n              null,\n              scheduleList?.map((x) => x?.dataItem?.length),\n            )}\n            dataItem={item.dataItem}\n            scheduleRender={scheduleRender}\n            timestampRange={item.timestampRange}\n          />\n        ))}\n      </div>\n    ),\n    [scheduleList, scheduleRender, containerWidth],\n  );\n\n  // 左侧时间刻度\n  const memo_TimeScale: JSX.Element = useMemo(\n    () => (\n      <div\n        className={style.WT_Calendar_scale}\n        style={{ height: `${HoursList.length * 30}px`, top: scrollHeight }}\n      >\n        <div style={{ position: 'relative' }}>\n          {HoursList.map((h, index) => (\n            <div className={style.WT_Calendar_scale_item} key={index}>\n              <span className={style.WT_Calendar_scale_text} style={{ top: index === 0 && -5 }}>\n                {`${h < 10 ? `0${h}` : h}:00`}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n    ),\n    [scrollHeight],\n  );\n\n  // 拖动时间基线\n  const movingBaseLine: JSX.Element = useMemo(\n    () => <MovingBaseLine movingTop={movingTop} scrollHeight={scrollHeight} isShow={isMoving} />,\n    [movingTop, scrollHeight, isMoving],\n  );\n\n  const isShowCurrTimeLine: (params: number) => boolean = (params) =>\n    getZeroTime(params) <= new Date().getTime() &&\n    new Date().getTime() < getZeroTime(params + 3600 * 24 * 1000);\n\n  const calcCurrTimeLineHeight: (params: number) => number = (params) =>\n    (moment(params).hour() * 60 + moment(params).minute()) / 2;\n\n  return (\n    <div\n      className={style.WT_Calendar_ScheduleCantainer_outer}\n      style={{ height: `${height - 155}px` }}\n    >\n      <>\n        {memo_TimeScale}\n        {memo_ScheduleItem}\n        {movingBaseLine}\n        {isShowCurrTimeLine(targetDay) && (\n          <div\n            className={style.WT_Calendar_ScheduleCantainer_currTimeLine}\n            style={{ top: `${currTimeLineHeight + scrollHeight}px` }}\n          >\n            <div className={style.WT_Calendar_ScheduleCantainer_startPoint} />\n          </div>\n        )}\n      </>\n    </div>\n  );\n};\n\nexport default ScheduleCantainer;\n"],"mappings":"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"}